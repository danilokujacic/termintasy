<app-layout>
  <app-players-wrapper
    (closeChanges)="onSelect($event)"
    [playerPosition]="playersDrawer()"
    [selectedPlayers]="selectedPlayers()"
    *ngIf="playersDrawer()"
  ></app-players-wrapper>
  <div class="w-full h-full relative flex flex-col pb-2">
    <div class="flex px-2 justify-between items-center">
      <div class="flex flex-col h-[75px] overflow-hidden">
        <p
          class="flex-1 overflow-hidden w-full whitespace-nowrap text-ellipsis"
        >
          {{ teamName() }}
        </p>
        <p *ngIf="typeof transfers() === 'number' && isOwner()">
          Transfers: {{ teamTransfers() >= 0 ? teamTransfers() : 0 }}
          <span *ngIf="teamTransfers() < 0"
            >{{ teamTransfers() * 4 }} points</span
          >
        </p>
        <div
          *ngIf="isOwner() && perks()"
          class="flex pt-2 justify-center gap-2"
        >
          <button
            role="button"
            (click)="
              tripleCaptainActive()
                ? deactivateTripleCaptain()
                : activateTripleCaptain()
            "
            [disabled]="!perks()?.tripleCaptain"
            [ngClass]="{
              'size-5 border disabled:opacity-20 border-gray-500 rounded-sm flex items-center justify-center': true,
              'border-blue-500 bg-blue-500 text-white':
                tripleCaptainActive() && perks()?.tripleCaptain
            }"
          >
            C
          </button>
          <button
            role="button"
            (click)="toggleWildCard()"
            [disabled]="!perks()?.wildcard"
            [ngClass]="{
              'size-5 border disabled:opacity-20 border-gray-500 rounded-sm flex items-center justify-center': true,
              'border-blue-500 bg-blue-500 text-white':
                wildCardActive() && perks()?.wildcard
            }"
          >
            W
          </button>
          <button
            role="button"
            (click)="toggleFreeHit()"
            [disabled]="!perks()?.freehit"
            [ngClass]="{
              'size-5 border disabled:opacity-20 border-gray-500 rounded-sm flex items-center justify-center': true,
              'border-blue-500 bg-blue-500 text-white':
                freeHitActive() && perks()?.freehit
            }"
          >
            F
          </button>
        </div>
      </div>
      <button
        *ngIf="playersToTransferTeamPlayersDif().length; else captain"
        (click)="makeTransfer()"
        class="text-blue-500"
      >
        Transfer
      </button>
      <ng-template #captain>
        <button
          role="button"
          *ngIf="isOwner() && !activeGame()"
          (click)="
            teamCaptainTemp() === teamCaptain() ? toggleCaptain() : newCaptain()
          "
          class="underline text-blue-500"
        >
          {{
            captainMode() && teamCaptainTemp() !== teamCaptain()
              ? 'Make captain'
              : 'Change captain'
          }}
        </button>
        <button
          (click)="captainMode.set(false)"
          *ngIf="captainMode() && isOwner()"
        >
          Cancel
        </button>
      </ng-template>
    </div>

    <div class="flex-1 relative soccer-field">
      <div class="absolute bottom-[35%] w-full">
        <app-player-card
          *ngIf="players().gk"
          [player]="players().gk"
          (queryPlayers)="queryPlayers('GK', 'gk', players().gk)"
          [captain]="players().gk?.id === teamCaptainTemp()"
          class="player-box left-1/2 -translate-x-1/2 absolute"
        ></app-player-card>
      </div>
      <div class="absolute bottom-[48%] w-full">
        <app-player-card
          *ngIf="players().def1"
          [player]="players().def1"
          (queryPlayers)="queryPlayers('DEF', 'def1', players().def2)"
          [captain]="players().def1?.id === teamCaptainTemp()"
          class="player-box left-[8%] absolute"
        ></app-player-card>
        <app-player-card
          *ngIf="players().def2"
          [player]="players().def2"
          (queryPlayers)="queryPlayers('DEF', 'def2', players().def2)"
          [captain]="players().def2?.id === teamCaptainTemp()"
          class="player-box right-[8%] absolute"
        ></app-player-card>
      </div>
      <div class="absolute bottom-[70%] w-full">
        <app-player-card
          *ngIf="players().mid"
          [player]="players().mid"
          (queryPlayers)="queryPlayers('MID', 'mid', players().mid)"
          [captain]="players().mid?.id === teamCaptainTemp()"
          class="player-box left-1/2 -translate-x-1/2 absolute"
        ></app-player-card>
      </div>
      <div class="absolute top-[5%] w-full">
        <app-player-card
          *ngIf="players().atk1"
          [player]="players().atk1"
          (queryPlayers)="queryPlayers('ATK', 'atk1', players().atk1)"
          [captain]="players().atk1?.id === teamCaptainTemp()"
          class="player-box left-[8%] absolute"
        ></app-player-card>
        <app-player-card
          *ngIf="players().atk2"
          [player]="players().atk2"
          (queryPlayers)="queryPlayers('ATK', 'atk2', players().atk2)"
          [captain]="players().atk2?.id === teamCaptainTemp()"
          class="player-box right-[8%] absolute"
        ></app-player-card>
      </div>
    </div>
  </div>
</app-layout>
<app-footer></app-footer>
